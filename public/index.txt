<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YouTube Downloader</title>
  <style>
    body { font-family: sans-serif; padding: 40px; background: #f4f4f4; }
    input, select, button { padding: 8px; margin: 5px; width: 300px; }
    .result { margin-top: 20px; }
  </style>
</head>
<body>
  <h2>YouTube Downloader</h2>
  <input id="query" placeholder="Enter song name or video ID" />
  <select id="type">
    <option value="video">Video</option>
    <option value="audio">Audio</option>
  </select><br>
  <input id="apikey" placeholder="Enter API Key" value="prem-babu" />
  <button onclick="handleSearch()">Download</button>

  <div id="result" class="result"></div>

  <script>
    async function handleSearch() {
      const query = document.getElementById('query').value.trim();
      const type = document.getElementById('type').value;
      const apikey = document.getElementById('apikey').value;

      const isID = /^[\w-]{11}$/.test(query); // Check if input is video ID

      let videoId = query;

      if (!isID) {
        const searchRes = await fetch(`/search?q=${encodeURIComponent(query)}&apikey=${apikey}`);
        const data = await searchRes.json();
        if (!data.videoId) return alert('Video not found');
        videoId = data.videoId;
      }

      const res = await fetch(`/youtube?id=${videoId}&type=${type}&apikey=${apikey}`);
      const json = await res.json();

      if (json.downloadUrl) {
        document.getElementById('result').innerHTML = `
          <h3>${json.title}</h3>
          <img src="${json.thumbnail}" width="200"/><br/>
          <a href="${json.downloadUrl}" target="_blank" download>Click to Download ${json.type}</a>
        `;
      } else {
        document.getElementById('result').innerText = 'Error: ' + json.error;
      }
    }
  </script>
</body>
</html>
